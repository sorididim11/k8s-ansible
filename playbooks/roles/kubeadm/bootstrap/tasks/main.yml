---

- name: swap off 
  become: yes
  command:  swapoff -a


- name: Init kubernetes
  become: yes
  command: kubeadm init --apiserver-advertise-address={{inventory_hostname}} --pod-network-cidr=10.244.0.0/16

# to make kubectl work for your non-root user
# mkdir -p $HOME/.kube
# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
# sudo chown $(id -u):$(id -g) $HOME/.kube/config
- block:
  - name: create dir 
    file: 
      path: ~/.kube
      state: directory
    
  - copy: 
      become: yes
      src: /etc/kubernetes/admin.conf
      dest: ~/.kube/config
      owner: "{{ansible_user_id}}"
      group: "{{ansible_user_id}}"
      remote_src: yes

- name: Install Pod network
  command: kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.10.0/Documentation/kube-flannel.yml


